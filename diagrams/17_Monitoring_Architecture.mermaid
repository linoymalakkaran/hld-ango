%%{init: {'theme':'base', 'themeVariables': {'fontSize': '8px', 'fontFamily': 'Arial, sans-serif'}}}%%
graph TB
    %% Data Sources - Applications and Infrastructure
    subgraph DataSources["ğŸ“Š DATA SOURCES"]
        direction TB
        
        subgraph ApplicationSources["Application Sources"]
            Microservices[âš™ï¸ JUL Microservices<br/>â€¢ Company Management<br/>â€¢ Declaration Management<br/>â€¢ Document Management<br/>â€¢ License & Permits<br/>â€¢ Integration Services]
            
            APIGateway[ğŸ¦ Kong API Gateway<br/>â€¢ Request/Response metrics<br/>â€¢ API performance<br/>â€¢ Rate limiting stats<br/>â€¢ Error rates]
            
            WebApplications[ğŸŒ Web Applications<br/>â€¢ Angular Frontend<br/>â€¢ User interactions<br/>â€¢ Page load times<br/>â€¢ JavaScript errors]
        end
        
        subgraph InfrastructureSources["Infrastructure Sources"]
            KubernetesCluster[â˜¸ï¸ Kubernetes Cluster<br/>â€¢ Pod metrics<br/>â€¢ Node performance<br/>â€¢ Resource utilization<br/>â€¢ Cluster health]
            
            Databases[ğŸ—ƒï¸ PostgreSQL Databases<br/>â€¢ Query performance<br/>â€¢ Connection pools<br/>â€¢ Replication lag<br/>â€¢ Lock statistics]
            
            MinIOStorage[ğŸ“¦ MinIO Storage<br/>â€¢ Storage utilization<br/>â€¢ I/O performance<br/>â€¢ Request latency<br/>â€¢ Error rates]
            
            RedisCache[âš¡ Redis Cache<br/>â€¢ Hit/Miss ratios<br/>â€¢ Memory usage<br/>â€¢ Connection stats<br/>â€¢ Command statistics]
            
            RabbitMQ[ğŸ° RabbitMQ<br/>â€¢ Queue depth<br/>â€¢ Message rates<br/>â€¢ Consumer lag<br/>â€¢ Connection stats]
        end
        
        subgraph ExternalSources["External Integration Sources"]
            ASYCUDAIntegration[ğŸ›ï¸ ASYCUDA Integration<br/>â€¢ Response times<br/>â€¢ Success rates<br/>â€¢ Error patterns<br/>â€¢ Message volume]
            
            SINTECEIntegration[ğŸ›ï¸ SINTECE Integration<br/>â€¢ API response times<br/>â€¢ Success rates<br/>â€¢ Certificate validations<br/>â€¢ System availability]
            
            NetworkInfrastructure[ğŸŒ Network Infrastructure<br/>â€¢ Bandwidth utilization<br/>â€¢ Latency metrics<br/>â€¢ Packet loss<br/>â€¢ Connection tracking]
        end
    end

    %% Metrics Collection Layer
    subgraph MetricsCollection["ğŸ“ˆ METRICS COLLECTION LAYER"]
        direction TB
        
        subgraph PrometheusStack["Prometheus Stack"]
            PrometheusServer[ğŸ“ˆ Prometheus Server<br/>â€¢ Metrics collection<br/>â€¢ Time-series storage<br/>â€¢ PromQL queries<br/>â€¢ Alert evaluation<br/>Retention: 30 days]
            
            NodeExporter[ğŸ“Š Node Exporter<br/>â€¢ System metrics<br/>â€¢ Hardware stats<br/>â€¢ OS performance<br/>â€¢ Process monitoring]
            
            KubeStateMetrics[â˜¸ï¸ Kube-State-Metrics<br/>â€¢ Kubernetes objects<br/>â€¢ Resource states<br/>â€¢ Pod status<br/>â€¢ Deployment health]
            
            CustomMetrics[âš™ï¸ Custom Application Metrics<br/>â€¢ Business metrics<br/>â€¢ Declaration counts<br/>â€¢ Processing times<br/>â€¢ User activity]
        end
        
        subgraph ServiceDiscovery["Service Discovery"]
            K8sServiceDiscovery[â˜¸ï¸ Kubernetes SD<br/>â€¢ Auto-discovery<br/>â€¢ Dynamic targets<br/>â€¢ Label-based filtering<br/>â€¢ Namespace isolation]
            
            ConsulSD[ğŸ” Consul SD<br/>â€¢ Service registry<br/>â€¢ Health checks<br/>â€¢ Dynamic configuration<br/>â€¢ Multi-datacenter]
        end
    end

    %% Visualization Layer
    subgraph VisualizationLayer["ğŸ“Š VISUALIZATION & DASHBOARDS"]
        direction TB
        
        subgraph GrafanaStack["Grafana Stack"]
            GrafanaServer[ğŸ“Š Grafana Server<br/>â€¢ Dashboard creation<br/>â€¢ Data visualization<br/>â€¢ User management<br/>â€¢ Alert annotations]
            
            subgraph GrafanaDashboards["Pre-built Dashboards"]
                InfraDashboard[ğŸ—ï¸ Infrastructure Dashboard<br/>â€¢ Kubernetes cluster overview<br/>â€¢ Node performance<br/>â€¢ Resource utilization<br/>â€¢ Network statistics]
                
                AppDashboard[âš™ï¸ Application Dashboard<br/>â€¢ Microservice health<br/>â€¢ API performance<br/>â€¢ Error rates<br/>â€¢ Response times]
                
                BusinessDashboard[ğŸ“‹ Business Dashboard<br/>â€¢ Declaration metrics<br/>â€¢ Processing volumes<br/>â€¢ User activity<br/>â€¢ System usage patterns]
                
                SecurityDashboard[ğŸ”’ Security Dashboard<br/>â€¢ Authentication events<br/>â€¢ Failed login attempts<br/>â€¢ API security metrics<br/>â€¢ Threat indicators]
                
                IntegrationDashboard[ğŸ”Œ Integration Dashboard<br/>â€¢ External system health<br/>â€¢ API call statistics<br/>â€¢ Message processing<br/>â€¢ Error tracking]
            end
        end
        
        subgraph CustomVisualization["Custom Visualization"]
            ExecutiveDashboard[ğŸ‘” Executive Dashboard<br/>â€¢ High-level KPIs<br/>â€¢ Business metrics<br/>â€¢ System availability<br/>â€¢ Performance trends]
            
            OperationalDashboard[âš™ï¸ Operational Dashboard<br/>â€¢ Real-time monitoring<br/>â€¢ Alert status<br/>â€¢ System health<br/>â€¢ Incident tracking]
        end
    end

    %% Logging and Observability
    subgraph LoggingStack["ğŸ“‹ LOGGING & OBSERVABILITY"]
        direction TB
        
        subgraph ELKStack["ELK Stack"]
            Elasticsearch[ğŸ” Elasticsearch Cluster<br/>â€¢ Log storage & indexing<br/>â€¢ Full-text search<br/>â€¢ Aggregations<br/>â€¢ Hot/warm/cold tiers<br/>Retention: 90 days]
            
            Logstash[ğŸ“‹ Logstash<br/>â€¢ Log processing<br/>â€¢ Data transformation<br/>â€¢ Filtering & parsing<br/>â€¢ Multi-input support]
            
            Kibana[ğŸ“Š Kibana<br/>â€¢ Log visualization<br/>â€¢ Search interface<br/>â€¢ Dashboard creation<br/>â€¢ Alert management]
            
            Filebeat[ğŸ“„ Filebeat<br/>â€¢ Log shipping<br/>â€¢ File monitoring<br/>â€¢ Multi-line handling<br/>â€¢ Kubernetes integration]
        end
        
        subgraph LogSources["Log Sources"]
            ApplicationLogs[ğŸ“ Application Logs<br/>â€¢ Structured logging<br/>â€¢ Error tracking<br/>â€¢ Request tracing<br/>â€¢ Business events]
            
            SystemLogs[ğŸ–¥ï¸ System Logs<br/>â€¢ Syslog messages<br/>â€¢ Kernel logs<br/>â€¢ Service logs<br/>â€¢ Security events]
            
            AuditLogs[ğŸ“ Audit Logs<br/>â€¢ User activities<br/>â€¢ System changes<br/>â€¢ Security events<br/>â€¢ Compliance tracking]
        end
    end

    %% Distributed Tracing
    subgraph TracingStack["ğŸ” DISTRIBUTED TRACING"]
        direction TB
        
        JaegerTracing[ğŸ” Jaeger<br/>â€¢ Distributed tracing<br/>â€¢ Request flow tracking<br/>â€¢ Performance analysis<br/>â€¢ Dependency mapping<br/>Retention: 7 days]
        
        subgraph TracingComponents["Tracing Components"]
            JaegerAgent[ğŸ“¡ Jaeger Agent<br/>â€¢ Trace collection<br/>â€¢ Local buffering<br/>â€¢ Protocol translation<br/>â€¢ Sampling decisions]
            
            JaegerCollector[ğŸ“¥ Jaeger Collector<br/>â€¢ Trace processing<br/>â€¢ Validation<br/>â€¢ Indexing<br/>â€¢ Storage backend]
            
            JaegerQuery[ğŸ” Jaeger Query<br/>â€¢ Trace retrieval<br/>â€¢ Search interface<br/>â€¢ Dependency graph<br/>â€¢ Performance metrics]
        end
    end

    %% Alerting System
    subgraph AlertingSystem["ğŸš¨ ALERTING & NOTIFICATION"]
        direction TB
        
        subgraph AlertManagerStack["AlertManager Stack"]
            AlertManager[ğŸš¨ AlertManager<br/>â€¢ Alert routing<br/>â€¢ Notification handling<br/>â€¢ Alert grouping<br/>â€¢ Silence management]
            
            AlertingRules[ğŸ“‹ Alerting Rules<br/>â€¢ Prometheus rules<br/>â€¢ Threshold definitions<br/>â€¢ Severity levels<br/>â€¢ Condition logic]
        end
        
        subgraph NotificationChannels["Notification Channels"]
            EmailAlerts[ğŸ“§ Email Notifications<br/>â€¢ SMTP integration<br/>â€¢ Template-based<br/>â€¢ Escalation rules<br/>â€¢ Group notifications]
            
            SlackAlerts[ğŸ’¬ Slack Integration<br/>â€¢ Channel notifications<br/>â€¢ Alert formatting<br/>â€¢ Interactive buttons<br/>â€¢ Status updates]
            
            SMSAlerts[ğŸ“± SMS Notifications<br/>â€¢ Critical alerts<br/>â€¢ On-call rotation<br/>â€¢ Emergency contacts<br/>â€¢ Rate limiting]
            
            WebhookAlerts[ğŸ”— Webhook Integration<br/>â€¢ ITSM integration<br/>â€¢ Custom systems<br/>â€¢ Automation triggers<br/>â€¢ External escalation]
        end
        
        subgraph AlertCategories["Alert Categories"]
            CriticalAlerts[ğŸ”´ Critical Alerts<br/>â€¢ System down<br/>â€¢ Data corruption<br/>â€¢ Security breaches<br/>â€¢ Service unavailable]
            
            WarningAlerts[ğŸŸ¡ Warning Alerts<br/>â€¢ High resource usage<br/>â€¢ Performance degradation<br/>â€¢ Capacity planning<br/>â€¢ Threshold breaches]
            
            InfoAlerts[ğŸ”µ Info Alerts<br/>â€¢ Deployment events<br/>â€¢ Maintenance windows<br/>â€¢ Configuration changes<br/>â€¢ Scheduled tasks]
        end
    end

    %% Performance Analytics
    subgraph PerformanceAnalytics["âš¡ PERFORMANCE ANALYTICS"]
        direction TB
        
        subgraph APMTools["APM Tools"]
            ApplicationInsights[ğŸ“Š Application Performance<br/>â€¢ Response time analysis<br/>â€¢ Throughput monitoring<br/>â€¢ Error rate tracking<br/>â€¢ User experience metrics]
            
            InfrastructureAPM[ğŸ—ï¸ Infrastructure Performance<br/>â€¢ Resource utilization<br/>â€¢ Capacity planning<br/>â€¢ Bottleneck identification<br/>â€¢ Trend analysis]
        end
        
        subgraph BusinessMetrics["Business Metrics"]
            KPIMonitoring[ğŸ“ˆ KPI Monitoring<br/>â€¢ Declaration processing times<br/>â€¢ System availability<br/>â€¢ User satisfaction<br/>â€¢ Business volumes]
            
            SLAMonitoring[ğŸ“‹ SLA Monitoring<br/>â€¢ Service level tracking<br/>â€¢ Compliance reporting<br/>â€¢ Performance baselines<br/>â€¢ Trend analysis]
        end
    end

    %% Health Checks and Synthetic Monitoring
    subgraph HealthMonitoring["â¤ï¸ HEALTH CHECKS & SYNTHETIC MONITORING"]
        direction TB
        
        subgraph HealthChecks["Health Checks"]
            LivenessProbes[ğŸ’“ Liveness Probes<br/>â€¢ Pod health status<br/>â€¢ Container restart<br/>â€¢ Service availability<br/>â€¢ Automated recovery]
            
            ReadinessProbes[âœ… Readiness Probes<br/>â€¢ Service readiness<br/>â€¢ Traffic routing<br/>â€¢ Load balancer integration<br/>â€¢ Graceful shutdown]
            
            CustomHealthChecks[âš™ï¸ Custom Health Checks<br/>â€¢ Database connectivity<br/>â€¢ External API status<br/>â€¢ Resource availability<br/>â€¢ Business logic validation]
        end
        
        subgraph SyntheticMonitoring["Synthetic Monitoring"]
            UptimeMonitoring[ğŸ“ˆ Uptime Monitoring<br/>â€¢ End-to-end availability<br/>â€¢ Geographic monitoring<br/>â€¢ Response time tracking<br/>â€¢ Alert automation]
            
            TransactionMonitoring[ğŸ”„ Transaction Monitoring<br/>â€¢ Critical user journeys<br/>â€¢ Business process monitoring<br/>â€¢ Performance baselines<br/>â€¢ Error detection]
        end
    end

    %% Security Monitoring
    subgraph SecurityMonitoring["ğŸ”’ SECURITY MONITORING"]
        direction TB
        
        SecurityEventLogs[ğŸ›¡ï¸ Security Event Logs<br/>â€¢ Authentication events<br/>â€¢ Authorization failures<br/>â€¢ Suspicious activities<br/>â€¢ Threat detection]
        
        SecurityDashboards[ğŸ“Š Security Dashboards<br/>â€¢ Security metrics<br/>â€¢ Threat indicators<br/>â€¢ Compliance status<br/>â€¢ Incident tracking]
        
        ComplianceReporting[ğŸ“‹ Compliance Reporting<br/>â€¢ Audit trail visualization<br/>â€¢ Regulatory reporting<br/>â€¢ Policy compliance<br/>â€¢ Risk assessment]
    end

    %% Data Flow Connections
    DataSources --> MetricsCollection
    MetricsCollection --> VisualizationLayer
    DataSources --> LoggingStack
    DataSources --> TracingStack
    
    MetricsCollection --> AlertingSystem
    LoggingStack --> AlertingSystem
    TracingStack --> PerformanceAnalytics
    
    VisualizationLayer --> PerformanceAnalytics
    HealthMonitoring --> AlertingSystem
    SecurityMonitoring --> AlertingSystem
    
    %% Monitoring Data Flow
    Microservices -.-> PrometheusServer
    KubernetesCluster -.-> NodeExporter
    ApplicationLogs -.-> Filebeat
    Filebeat -.-> Logstash
    Logstash -.-> Elasticsearch
    
    PrometheusServer -.-> GrafanaServer
    Elasticsearch -.-> Kibana
    JaegerTracing -.-> JaegerQuery
    
    AlertManager -.-> NotificationChannels

    %% Monitoring Infrastructure
    subgraph MonitoringInfrastructure["ğŸ—ï¸ MONITORING INFRASTRUCTURE"]
        direction TB
        
        MonitoringNamespace[ğŸ“Š jul-monitoring namespace<br/>â€¢ Isolated environment<br/>â€¢ Resource quotas<br/>â€¢ Network policies<br/>â€¢ Access controls]
        
        MonitoringStorage[ğŸ’¾ Monitoring Storage<br/>â€¢ Time-series data<br/>â€¢ Log storage<br/>â€¢ High-performance disks<br/>â€¢ Retention policies]
        
        MonitoringNetwork[ğŸŒ Monitoring Network<br/>â€¢ Service mesh integration<br/>â€¢ Secure communication<br/>â€¢ Load balancing<br/>â€¢ High availability]
    end

    %% Styling
    classDef sourceBox fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
    classDef metricsBox fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000
    classDef visualBox fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#000
    classDef loggingBox fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef alertBox fill:#ffebee,stroke:#c62828,stroke-width:2px,color:#000
    classDef perfBox fill:#f1f8e9,stroke:#33691e,stroke-width:2px,color:#000
    classDef securityBox fill:#fce4ec,stroke:#ad1457,stroke-width:2px,color:#000

    class DataSources sourceBox
    class MetricsCollection metricsBox
    class VisualizationLayer visualBox
    class LoggingStack,TracingStack loggingBox
    class AlertingSystem alertBox
    class PerformanceAnalytics,HealthMonitoring perfBox
    class SecurityMonitoring securityBox