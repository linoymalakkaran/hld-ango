%%{init: {'theme':'base', 'themeVariables': {'fontSize': '8px', 'fontFamily': 'Arial, sans-serif'}}}%%
graph TB
    %% Production Environment
    subgraph Prod["ğŸ”´ PRODUCTION"]
        direction TB
        
        subgraph ProdInfra["Prod Infra"]
            ProdLB[âš–ï¸ Prod LB HA]
            
            subgraph ProdCluster["Prod K8s"]
                ProdMaster1[ğŸ›ï¸ Master1]
                ProdMaster2[ğŸ›ï¸ Master2]
                ProdMaster3[ğŸ›ï¸ Master3]
                
                ProdWorker1[ğŸ’» Worker1 32c/128GB]
                ProdWorker2[ğŸ’» Worker2 32c/128GB]
                ProdWorker3[ğŸ’» Worker3 32c/128GB]
                ProdWorkerN[ğŸ’» WorkerN 32c/128GB]
            end
            
            subgraph ProdData["Prod Data"]
                ProdDB1[(ğŸ—ƒï¸ PG Primary)]
                ProdDB2[(ğŸ—ƒï¸ PG Replica1)]
                ProdDB3[(ğŸ—ƒï¸ PG Replica2)]
                ProdMinIO1[ğŸ“¦ MinIO1]
                ProdMinIO2[ğŸ“¦ MinIO2]
                ProdMinION[ğŸ“¦ MinIO6+]
                ProdRedis[âš¡ Redis Cluster]
            end
        end
    end

    %% Staging Environment
    subgraph Stage["ğŸŸ¡ STAGING ENVIRONMENT"]
        direction TB
        
        subgraph StageInfra["Staging Infrastructure"]
            StageLB[âš–ï¸ Staging Load Balancer]
            
            subgraph StageCluster["Staging K8s Cluster"]
                StageMaster1[ğŸ›ï¸ Master Node 1]
                StageMaster2[ğŸ›ï¸ Master Node 2]
                StageMaster3[ğŸ›ï¸ Master Node 3]
                
                StageWorker1[ğŸ’» Worker Node 1<br/>16 vCPU, 64GB RAM]
                StageWorker2[ğŸ’» Worker Node 2<br/>16 vCPU, 64GB RAM]
                StageWorker3[ğŸ’» Worker Node 3<br/>16 vCPU, 64GB RAM]
                StageWorker4[ğŸ’» Worker Node 4<br/>16 vCPU, 64GB RAM]
                StageWorker5[ğŸ’» Worker Node 5<br/>16 vCPU, 64GB RAM]
            end
            
            subgraph StageData["Staging Data Tier"]
                StageDB1[(ğŸ—ƒï¸ PostgreSQL Primary)]
                StageDB2[(ğŸ—ƒï¸ PostgreSQL Replica)]
                StageMinIO[ğŸ“¦ MinIO 3-Node<br/>Distributed]
                StageRedis[âš¡ Redis Cluster<br/>3 Nodes]
            end
        end
    end

    %% Development Environment
    subgraph Dev["ğŸŸ¢ DEVELOPMENT ENVIRONMENT"]
        direction TB
        
        subgraph DevInfra["Development Infrastructure"]
            DevLB[âš–ï¸ Dev Load Balancer]
            
            subgraph DevCluster["Development K8s Cluster"]
                DevMaster[ğŸ›ï¸ Master Node<br/>Single Master]
                DevWorker1[ğŸ’» Worker Node 1<br/>8 vCPU, 32GB RAM]
                DevWorker2[ğŸ’» Worker Node 2<br/>8 vCPU, 32GB RAM]
                DevWorker3[ğŸ’» Worker Node 3<br/>8 vCPU, 32GB RAM]
            end
            
            subgraph DevData["Development Data Tier"]
                DevDB[(ğŸ—ƒï¸ PostgreSQL<br/>Single Instance)]
                DevMinIO[ğŸ“¦ MinIO<br/>Single Node]
                DevRedis[âš¡ Redis<br/>Single Instance]
            end
        end
        
        subgraph DevTools["Development Tools"]
            GitLab[ğŸ“š GitLab CE<br/>Source Control & CI/CD]
            Harbor[ğŸ³ Harbor Registry<br/>Container Images]
            SonarQube[ğŸ” SonarQube<br/>Code Quality]
        end
    end

    %% Monitoring and Management
    subgraph Monitor["ğŸ“Š MONITORING & MANAGEMENT"]
        direction TB
        
        subgraph MonitorStack["Monitoring Stack"]
            Prometheus[ğŸ“ˆ Prometheus<br/>Metrics Collection]
            Grafana[ğŸ“Š Grafana<br/>Dashboards]
            AlertManager[ğŸš¨ AlertManager<br/>Alerting]
        end
        
        subgraph LoggingStack["Logging Stack"]
            Elasticsearch[ğŸ” Elasticsearch<br/>Log Storage]
            Logstash[ğŸ“‹ Logstash<br/>Log Processing]
            Kibana[ğŸ“Š Kibana<br/>Log Visualization]
        end
        
        subgraph TracingStack["Tracing Stack"]
            Jaeger[ğŸ” Jaeger<br/>Distributed Tracing]
        end
    end

    %% Network and Security
    subgraph Security["ğŸ›¡ï¸ SECURITY & NETWORK"]
        direction TB
        
        subgraph Network["Network Infrastructure"]
            Firewall[ğŸ”¥ Firewall<br/>iptables/pfSense]
            VPN[ğŸ”’ VPN Gateway<br/>Admin Access]
            DNS[ğŸŒ DNS Server<br/>Internal Resolution]
        end
        
        subgraph SecurityTools["Security Tools"]
            WAF[ğŸ›¡ï¸ WAF<br/>ModSecurity]
            IDS[ğŸ‘ï¸ IDS/IPS<br/>Intrusion Detection]
            Vault[ğŸ” HashiCorp Vault<br/>Secrets Management]
        end
    end

    %% Backup and DR
    subgraph Backup["ğŸ’¾ BACKUP & DISASTER RECOVERY"]
        direction TB
        
        subgraph BackupSys["Backup Systems"]
            BackupPrimary[ğŸ’¾ Primary Backup<br/>Daily Full + Incremental]
            BackupOffsite[ğŸŒ Offsite Backup<br/>Cross-site Replication]
        end
        
        subgraph DRSite["Disaster Recovery Site"]
            DRCluster[â˜ï¸ DR Kubernetes Cluster<br/>Cold Standby]
            DRStorage[ğŸ’¾ DR Storage<br/>Synchronized]
        end
    end

    %% External Connections
    subgraph External["ğŸŒ EXTERNAL SYSTEMS"]
        Internet[ğŸŒ Internet<br/>Public Access]
        ASYCUDA_Ext[ğŸ›ï¸ ASYCUDA<br/>AGT Network]
        SINTECE_Ext[ğŸ›ï¸ SINTECE<br/>Government Network]
        OGA_Ext[ğŸ›ï¸ OGA Systems<br/>Agency Networks]
        Banks[ğŸ¦ Banking Networks<br/>Payment Processing]
    end

    %% Connections
    Internet --> Security
    Security --> ProdLB
    Security --> StageLB
    Security --> DevLB
    
    ProdLB --> ProdCluster
    StageLB --> StageCluster
    DevLB --> DevCluster
    
    ProdCluster --> ProdData
    StageCluster --> StageData
    DevCluster --> DevData
    
    ProdData --> BackupPrimary
    BackupPrimary --> BackupOffsite
    BackupOffsite --> DRSite
    
    ProdCluster --> ASYCUDA_Ext
    ProdCluster --> SINTECE_Ext
    ProdCluster --> OGA_Ext
    ProdCluster --> Banks
    
    Monitor --> ProdCluster
    Monitor --> StageCluster
    Monitor --> DevCluster

    %% Styling
    classDef prodBox fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#000
    classDef stageBox fill:#fff8e1,stroke:#f57c00,stroke-width:2px,color:#000
    classDef devBox fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
    classDef infraBox fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000
    classDef externalBox fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000

    class Prod prodBox
    class Stage stageBox
    class Dev devBox
    class Monitor,Security,Backup infraBox
    class External externalBox