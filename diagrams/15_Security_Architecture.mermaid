%%{init: {'theme':'base', 'themeVariables': {'fontSize': '8px', 'fontFamily': 'Arial, sans-serif'}}}%%
graph TB
    %% External Threats
    subgraph Threats["ğŸŒ EXTERNAL THREATS & ATTACK VECTORS"]
        direction TB
        DDoSAttacks[ğŸ’¥ DDoS Attacks<br/>Volumetric & Application Layer]
        WebAttacks[ğŸ•¸ï¸ Web Application Attacks<br/>OWASP Top 10]
        APIAttacks[ğŸ”Œ API Attacks<br/>Injection & Abuse]
        MalwareThreats[ğŸ¦  Malware & Virus<br/>File Upload Threats]
        SocialEngineering[ğŸ­ Social Engineering<br/>Phishing & Fraud]
    end

    %% Perimeter Security
    subgraph PerimeterSecurity["ğŸ›¡ï¸ PERIMETER SECURITY - DMZ"]
        direction TB
        
        subgraph EdgeProtection["Edge Protection"]
            CloudflareWAF[â˜ï¸ Cloudflare WAF<br/>â€¢ DDoS Protection<br/>â€¢ Bot Management<br/>â€¢ Rate Limiting<br/>â€¢ Geo-blocking]
            
            ExternalFirewall[ğŸ”¥ External Firewall<br/>â€¢ Network-level Filtering<br/>â€¢ Port Management<br/>â€¢ IP Whitelisting<br/>â€¢ Threat Intelligence]
            
            IDS_IPS[ğŸ” IDS/IPS<br/>â€¢ Intrusion Detection<br/>â€¢ Automated Response<br/>â€¢ Signature-based Detection<br/>â€¢ Anomaly Detection]
        end
        
        subgraph LoadBalancerSecurity["Load Balancer Security"]
            SecureLoadBalancer[âš–ï¸ Secure Load Balancer<br/>â€¢ SSL/TLS Termination<br/>â€¢ Certificate Management<br/>â€¢ Header Security<br/>â€¢ Request Filtering]
            
            WebApplicationFirewall[ğŸ›¡ï¸ Web Application Firewall<br/>â€¢ ModSecurity Rules<br/>â€¢ OWASP Protection<br/>â€¢ Custom Rules<br/>â€¢ Request Validation]
        end
    end

    %% Network Security
    subgraph NetworkSecurity["ğŸŒ NETWORK SECURITY"]
        direction TB
        
        subgraph NetworkSegmentation["Network Segmentation"]
            VLANSeparation[ğŸ”€ VLAN Separation<br/>â€¢ DMZ: 172.16.1.0/24<br/>â€¢ App: 10.10.0.0/16<br/>â€¢ Data: 10.20.0.0/16<br/>â€¢ Mgmt: 10.30.0.0/16]
            
            FirewallRules[ğŸ“‹ Firewall Rules<br/>â€¢ Zero Trust Model<br/>â€¢ Least Privilege<br/>â€¢ Port Restrictions<br/>â€¢ Traffic Monitoring]
            
            NetworkACLs[ğŸ“ Network ACLs<br/>â€¢ Subnet-level Control<br/>â€¢ Protocol Filtering<br/>â€¢ Direction Control<br/>â€¢ Logging]
        end
        
        subgraph VPNSecurity["VPN Security"]
            AdminVPN[ğŸ”’ Admin VPN<br/>â€¢ IPSec/OpenVPN<br/>â€¢ Certificate-based Auth<br/>â€¢ Multi-Factor Auth<br/>â€¢ Session Monitoring]
            
            SiteToSiteVPN[ğŸ›ï¸ Site-to-Site VPN<br/>â€¢ Government Networks<br/>â€¢ Partner Connections<br/>â€¢ Encrypted Tunnels<br/>â€¢ Redundant Paths]
        end
    end

    %% Application Security
    subgraph ApplicationSecurity["âš™ï¸ APPLICATION SECURITY"]
        direction TB
        
        subgraph APIGatewaySecurity["API Gateway Security"]
            Kong[ğŸ¦ Kong API Gateway<br/>â€¢ OAuth 2.0 Validation<br/>â€¢ Rate Limiting<br/>â€¢ Request/Response Filtering<br/>â€¢ API Key Management<br/>â€¢ CORS Policy]
            
            APISecurityPolicies[ğŸ” API Security Policies<br/>â€¢ Authentication Required<br/>â€¢ Role-based Authorization<br/>â€¢ Input Validation<br/>â€¢ Output Sanitization]
        end
        
        subgraph MicroservicesSecurity["Microservices Security"]
            ServiceMesh[ğŸ•¸ï¸ Service Mesh Security<br/>â€¢ mTLS Communication<br/>â€¢ Service-to-Service Auth<br/>â€¢ Traffic Encryption<br/>â€¢ Zero Trust Network]
            
            ContainerSecurity[ğŸ“¦ Container Security<br/>â€¢ Image Scanning<br/>â€¢ Runtime Protection<br/>â€¢ Vulnerability Management<br/>â€¢ Secure Base Images]
            
            SecretManagement[ğŸ” Secret Management<br/>â€¢ Kubernetes Secrets<br/>â€¢ Encryption at Rest<br/>â€¢ Rotation Policies<br/>â€¢ Access Control]
        end
    end

    %% Identity & Access Management
    subgraph IAMSecurity["ğŸ‘¤ IDENTITY & ACCESS MANAGEMENT"]
        direction TB
        
        subgraph KeycloakSecurity["Keycloak Security"]
            AuthenticationSecurity[ğŸ”‘ Authentication Security<br/>â€¢ Multi-Factor Authentication<br/>â€¢ Password Policies<br/>â€¢ Account Lockout<br/>â€¢ Session Management]
            
            AuthorizationSecurity[ğŸ›¡ï¸ Authorization Security<br/>â€¢ Role-Based Access Control<br/>â€¢ Attribute-Based Access<br/>â€¢ Fine-grained Permissions<br/>â€¢ Dynamic Authorization]
            
            SessionSecurity[ğŸ”„ Session Security<br/>â€¢ Secure Token Storage<br/>â€¢ Token Rotation<br/>â€¢ Session Timeout<br/>â€¢ Concurrent Session Limits]
        end
        
        subgraph IdentityProtection["Identity Protection"]
            UserVerification[âœ… User Verification<br/>â€¢ Email Verification<br/>â€¢ Phone Verification<br/>â€¢ Document Verification<br/>â€¢ Background Checks]
            
            AccountSecurity[ğŸ”’ Account Security<br/>â€¢ Strong Password Policy<br/>â€¢ Password Breach Detection<br/>â€¢ Suspicious Activity Detection<br/>â€¢ Account Recovery Security]
        end
    end

    %% Data Security
    subgraph DataSecurity["ğŸ—ƒï¸ DATA SECURITY"]
        direction TB
        
        subgraph EncryptionSecurity["Encryption Security"]
            TransitEncryption[ğŸ”’ Encryption in Transit<br/>â€¢ TLS 1.3<br/>â€¢ Perfect Forward Secrecy<br/>â€¢ Certificate Pinning<br/>â€¢ HSTS Headers]
            
            RestEncryption[ğŸ”’ Encryption at Rest<br/>â€¢ Database Encryption<br/>â€¢ File System Encryption<br/>â€¢ Backup Encryption<br/>â€¢ Key Management]
            
            ApplicationEncryption[ğŸ”’ Application-level Encryption<br/>â€¢ Field-level Encryption<br/>â€¢ PII Protection<br/>â€¢ Tokenization<br/>â€¢ Data Masking]
        end
        
        subgraph DatabaseSecurity["Database Security"]
            PostgreSQLSecurity[ğŸ—ƒï¸ PostgreSQL Security<br/>â€¢ Connection Encryption<br/>â€¢ User Authentication<br/>â€¢ Row-level Security<br/>â€¢ Audit Logging]
            
            MinIOSecurity[ğŸ“¦ MinIO Security<br/>â€¢ Server-side Encryption<br/>â€¢ Access Policies<br/>â€¢ Bucket Policies<br/>â€¢ Audit Logging]
            
            RedisSecurity[âš¡ Redis Security<br/>â€¢ AUTH Authentication<br/>â€¢ ACL (Access Control Lists)<br/>â€¢ TLS Encryption<br/>â€¢ Memory Protection]
        end
    end

    %% Security Monitoring
    subgraph SecurityMonitoring["ğŸ“Š SECURITY MONITORING & LOGGING"]
        direction TB
        
        subgraph SIEM["SIEM & Log Analysis"]
            ELKSecurity[ğŸ“‹ ELK Stack Security<br/>â€¢ Security Event Logging<br/>â€¢ Log Correlation<br/>â€¢ Threat Detection<br/>â€¢ Incident Response]
            
            SecurityDashboards[ğŸ“Š Security Dashboards<br/>â€¢ Real-time Monitoring<br/>â€¢ Threat Indicators<br/>â€¢ Security Metrics<br/>â€¢ Compliance Reports]
        end
        
        subgraph ThreatDetection["Threat Detection"]
            AnomalyDetection[ğŸ” Anomaly Detection<br/>â€¢ User Behavior Analytics<br/>â€¢ Network Traffic Analysis<br/>â€¢ Application Performance<br/>â€¢ Data Access Patterns]
            
            ThreatIntelligence[ğŸ§  Threat Intelligence<br/>â€¢ IOC Feeds<br/>â€¢ Reputation Services<br/>â€¢ Vulnerability Feeds<br/>â€¢ Attack Signatures]
        end
        
        subgraph IncidentResponse["Incident Response"]
            AlertingSystem[ğŸš¨ Alerting System<br/>â€¢ Real-time Alerts<br/>â€¢ Escalation Procedures<br/>â€¢ Multi-channel Notifications<br/>â€¢ Alert Correlation]
            
            IncidentManagement[ğŸ“‹ Incident Management<br/>â€¢ Incident Classification<br/>â€¢ Response Procedures<br/>â€¢ Evidence Collection<br/>â€¢ Recovery Plans]
        end
    end

    %% Compliance & Governance
    subgraph ComplianceSecurity["ğŸ“œ COMPLIANCE & GOVERNANCE"]
        direction TB
        
        subgraph RegulatoryCompliance["Regulatory Compliance"]
            DataProtection[ğŸ›¡ï¸ Data Protection<br/>â€¢ Angola Data Protection Laws<br/>â€¢ GDPR Compliance<br/>â€¢ Data Residency<br/>â€¢ Right to be Forgotten]
            
            FinancialCompliance[ğŸ’° Financial Compliance<br/>â€¢ AML Regulations<br/>â€¢ KYC Requirements<br/>â€¢ Transaction Monitoring<br/>â€¢ Suspicious Activity Reporting]
            
            CustomsCompliance[ğŸ›ï¸ Customs Compliance<br/>â€¢ WCO Standards<br/>â€¢ Audit Requirements<br/>â€¢ Record Retention<br/>â€¢ Data Integrity]
        end
        
        subgraph SecurityGovernance["Security Governance"]
            SecurityPolicies[ğŸ“‹ Security Policies<br/>â€¢ Security Standards<br/>â€¢ Procedures & Guidelines<br/>â€¢ Risk Management<br/>â€¢ Security Training]
            
            AuditCompliance[ğŸ“ Audit & Compliance<br/>â€¢ Security Audits<br/>â€¢ Vulnerability Assessments<br/>â€¢ Penetration Testing<br/>â€¢ Compliance Reporting]
        end
    end

    %% Business Continuity
    subgraph BusinessContinuity["ğŸ”„ BUSINESS CONTINUITY & DR"]
        direction TB
        
        subgraph BackupSecurity["Backup Security"]
            EncryptedBackups[ğŸ”’ Encrypted Backups<br/>â€¢ Backup Encryption<br/>â€¢ Secure Storage<br/>â€¢ Access Control<br/>â€¢ Integrity Verification]
            
            OffsiteBackups[ğŸŒ Offsite Backups<br/>â€¢ Geographic Distribution<br/>â€¢ Secure Transport<br/>â€¢ Air-gapped Storage<br/>â€¢ Regular Testing]
        end
        
        subgraph DisasterRecovery["Disaster Recovery"]
            DRSecurity[ğŸ¥ DR Security<br/>â€¢ Secure DR Site<br/>â€¢ Data Replication Security<br/>â€¢ Recovery Procedures<br/>â€¢ Security Validation]
            
            BCPSecurity[ğŸ“‹ BCP Security<br/>â€¢ Security Continuity Plans<br/>â€¢ Emergency Procedures<br/>â€¢ Communication Security<br/>â€¢ Alternate Operations]
        end
    end

    %% Security Testing
    subgraph SecurityTesting["ğŸ§ª SECURITY TESTING & VALIDATION"]
        direction TB
        
        subgraph AutomatedTesting["Automated Testing"]
            SAST[ğŸ” SAST<br/>Static Application Security Testing<br/>Code Analysis<br/>Vulnerability Detection]
            
            DAST[ğŸ•¸ï¸ DAST<br/>Dynamic Application Security Testing<br/>Runtime Analysis<br/>Penetration Testing]
            
            IAST[âš¡ IAST<br/>Interactive Application Security Testing<br/>Real-time Analysis<br/>Code Coverage]
        end
        
        subgraph ManualTesting["Manual Testing"]
            PenTesting[ğŸ¯ Penetration Testing<br/>â€¢ External Testing<br/>â€¢ Internal Testing<br/>â€¢ Social Engineering<br/>â€¢ Physical Security]
            
            VulnAssessment[ğŸ” Vulnerability Assessment<br/>â€¢ Network Scanning<br/>â€¢ Application Testing<br/>â€¢ Configuration Review<br/>â€¢ Risk Assessment]
        end
    end

    %% Attack Flow Prevention
    Threats --> PerimeterSecurity
    PerimeterSecurity --> NetworkSecurity
    NetworkSecurity --> ApplicationSecurity
    ApplicationSecurity --> IAMSecurity
    IAMSecurity --> DataSecurity

    %% Monitoring Integration
    SecurityMonitoring -.-> ApplicationSecurity
    SecurityMonitoring -.-> DataSecurity
    SecurityMonitoring -.-> NetworkSecurity
    SecurityMonitoring -.-> IAMSecurity

    %% Compliance Integration
    ComplianceSecurity -.-> DataSecurity
    ComplianceSecurity -.-> SecurityMonitoring
    ComplianceSecurity -.-> IAMSecurity

    %% Business Continuity Integration
    BusinessContinuity -.-> DataSecurity
    BusinessContinuity -.-> SecurityMonitoring

    %% Security Testing Integration
    SecurityTesting -.-> ApplicationSecurity
    SecurityTesting -.-> NetworkSecurity
    SecurityTesting -.-> ComplianceSecurity

    %% Security Layers Visualization
    subgraph SecurityLayers["ğŸ”’ DEFENSE IN DEPTH LAYERS"]
        direction LR
        Layer1[ğŸŒ Perimeter]
        Layer2[ğŸŒ Network]
        Layer3[âš™ï¸ Application]
        Layer4[ğŸ‘¤ Identity]
        Layer5[ğŸ—ƒï¸ Data]
        Layer6[ğŸ“Š Monitoring]
        
        Layer1 --> Layer2
        Layer2 --> Layer3
        Layer3 --> Layer4
        Layer4 --> Layer5
        Layer5 --> Layer6
    end

    %% Styling
    classDef threatBox fill:#ffcdd2,stroke:#d32f2f,stroke-width:3px,color:#000
    classDef perimeterBox fill:#f8bbd9,stroke:#c2185b,stroke-width:2px,color:#000
    classDef networkBox fill:#e1f5fe,stroke:#0277bd,stroke-width:2px,color:#000
    classDef appBox fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,color:#000
    classDef iamBox fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    classDef dataBox fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef monitorBox fill:#e0f2f1,stroke:#00695c,stroke-width:2px,color:#000
    classDef complianceBox fill:#fce4ec,stroke:#ad1457,stroke-width:2px,color:#000

    class Threats threatBox
    class PerimeterSecurity perimeterBox
    class NetworkSecurity networkBox
    class ApplicationSecurity appBox
    class IAMSecurity iamBox
    class DataSecurity dataBox
    class SecurityMonitoring monitorBox
    class ComplianceSecurity,BusinessContinuity,SecurityTesting complianceBox