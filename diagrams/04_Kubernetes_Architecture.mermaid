%%{init: {'theme':'base', 'themeVariables': {'fontSize': '10px', 'fontFamily': 'Arial, sans-serif'}}}%%
graph TB
    %% External Traffic
    Internet[ğŸŒ Internet Traffic]
    
    %% Ingress Layer
    subgraph Ingress["ğŸšª INGRESS LAYER"]
        direction TB
        IngressController[ğŸšª NGINX Ingress Controller<br/>SSL Termination & Load Balancing]
        IngressService[âš™ï¸ Ingress Service<br/>Type: LoadBalancer]
    end

    %% Namespace Organization
    subgraph Production["ğŸ”´ PRODUCTION NAMESPACE"]
        direction TB
        
        subgraph ApiGateway["API Gateway"]
            KongPod[ğŸ¦ Kong API Gateway<br/>Pod Replicas: 3]
            KongService[âš™ï¸ Kong Service<br/>ClusterIP: 8000]
        end
        
        subgraph CoreServices["Core Business Services"]
            CompanyPods[ğŸ¢ Company Management<br/>Pod Replicas: 2<br/>Port 8081]
            LicensePods[ğŸ“œ License & Permits<br/>Pod Replicas: 2<br/>Port 8082]
            AgentPods[ğŸ‘¥ Agent Nomination<br/>Pod Replicas: 2<br/>Port 8083]
            DeclarationPods[ğŸ“‹ Declaration Management<br/>Pod Replicas: 3<br/>Port 8084]
            DocumentPods[ğŸ“„ Document Management<br/>Pod Replicas: 2<br/>Port 8085]
            MasterDataPods[ğŸ—‚ï¸ Master Data Management<br/>Pod Replicas: 2<br/>Port 8086]
        end
        
        subgraph IntegrationServices["Integration Services"]
            ASYCUDAPods[ğŸ›ï¸ ASYCUDA Integration<br/>Pod Replicas: 2<br/>Port 9081]
            SINTECEPods[ğŸ›ï¸ SINTECE Integration<br/>Pod Replicas: 2<br/>Port 9082]
            OGAPods[ğŸ›ï¸ OGA Integration<br/>Pod Replicas: 2<br/>Port 9083]
        end
        
        subgraph CrossCuttingServices["Cross-Cutting Services"]
            KeycloakPods[ğŸ” Keycloak<br/>Pod Replicas: 3<br/>Port 8080]
            NotificationPods[ğŸ“§ Notification Service<br/>Pod Replicas: 2<br/>Port 8089]
            WorkflowPods[ğŸ”„ Camunda Workflow<br/>Pod Replicas: 2<br/>Port 8090]
            AuditPods[ğŸ“ Audit & Logging<br/>Pod Replicas: 2<br/>Port 8091]
            ReportingPods[ğŸ“Š Reporting Service<br/>Pod Replicas: 2<br/>Port 8092]
        end
    end

    %% Data Layer
    subgraph DataLayer["ğŸ—ƒï¸ DATA LAYER"]
        direction TB
        
        subgraph DatabaseCluster["PostgreSQL StatefulSets"]
            PostgreSQLMaster[(ğŸ—ƒï¸ PostgreSQL Master<br/>StatefulSet<br/>Primary Instance)]
            PostgreSQLReplica1[(ğŸ—ƒï¸ PostgreSQL Replica 1<br/>StatefulSet<br/>Read Replica)]
            PostgreSQLReplica2[(ğŸ—ƒï¸ PostgreSQL Replica 2<br/>StatefulSet<br/>Read Replica)]
        end
        
        subgraph StorageCluster["MinIO StatefulSets"]
            MinIONode1[ğŸ“¦ MinIO Node 1<br/>StatefulSet]
            MinIONode2[ğŸ“¦ MinIO Node 2<br/>StatefulSet]
            MinIONode3[ğŸ“¦ MinIO Node 3<br/>StatefulSet]
            MinIONodeN[ğŸ“¦ MinIO Node N<br/>StatefulSet]
        end
        
        subgraph CacheCluster["Redis StatefulSets"]
            RedisMaster[âš¡ Redis Master<br/>StatefulSet]
            RedisSentinel[ğŸ” Redis Sentinel<br/>StatefulSet]
            RedisReplica[âš¡ Redis Replica<br/>StatefulSet]
        end
        
        subgraph MessageQueue["RabbitMQ StatefulSets"]
            RabbitMQNode1[ğŸ° RabbitMQ Node 1<br/>StatefulSet]
            RabbitMQNode2[ğŸ° RabbitMQ Node 2<br/>StatefulSet]
            RabbitMQNode3[ğŸ° RabbitMQ Node 3<br/>StatefulSet]
        end
    end

    %% Storage Layer
    subgraph Storage["ğŸ’¾ STORAGE LAYER"]
        direction TB
        
        subgraph PersistentStorage["Persistent Volumes"]
            DBPV[ğŸ’¾ Database PVs<br/>SSD Storage Class<br/>ReadWriteOnce]
            MinIOPV[ğŸ’¾ MinIO PVs<br/>SSD Storage Class<br/>ReadWriteOnce]
            ConfigPV[ğŸ’¾ Config PVs<br/>Standard Storage Class<br/>ReadWriteMany]
        end
        
        subgraph StorageClasses["Storage Classes"]
            FastSSD[âš¡ fast-ssd<br/>NVMe Storage<br/>Provisioner: local-path]
            StandardSSD[ğŸ’¾ standard-ssd<br/>SSD Storage<br/>Provisioner: local-path]
            BackupStorage[ğŸ’¾ backup-storage<br/>Network Storage<br/>Provisioner: nfs]
        end
    end

    %% Configuration Management
    subgraph ConfigMgmt["âš™ï¸ CONFIGURATION MANAGEMENT"]
        direction TB
        
        subgraph ConfigMaps["ConfigMaps"]
            AppConfig[âš™ï¸ App Configuration<br/>Database URLs, API Keys]
            EnvConfig[ğŸŒ Environment Config<br/>Feature Flags, Limits]
            LogConfig[ğŸ“‹ Logging Config<br/>Log Levels, Formats]
        end
        
        subgraph Secrets["Secrets"]
            DBSecrets[ğŸ” Database Secrets<br/>Passwords, Connection Strings]
            APISecrets[ğŸ” API Secrets<br/>OAuth Keys, Certificates]
            TLSSecrets[ğŸ” TLS Secrets<br/>SSL Certificates, Private Keys]
        end
    end

    %% Monitoring Namespace
    subgraph Monitoring["ğŸ“Š MONITORING NAMESPACE"]
        direction TB
        
        subgraph MonitoringPods["Monitoring Services"]
            PrometheusPods[ğŸ“ˆ Prometheus<br/>Pod Replicas: 2<br/>Metrics Collection]
            GrafanaPods[ğŸ“Š Grafana<br/>Pod Replicas: 2<br/>Dashboards]
            AlertManagerPods[ğŸš¨ AlertManager<br/>Pod Replicas: 2<br/>Alerting]
        end
        
        subgraph LoggingPods["Logging Services"]
            ElasticsearchPods[ğŸ” Elasticsearch<br/>StatefulSet: 3<br/>Log Storage]
            LogstashPods[ğŸ“‹ Logstash<br/>Pod Replicas: 2<br/>Log Processing]
            KibanaPods[ğŸ“Š Kibana<br/>Pod Replicas: 1<br/>Log Visualization]
        end
        
        subgraph TracingPods["Tracing Services"]
            JaegerPods[ğŸ” Jaeger<br/>Pod Replicas: 1<br/>Distributed Tracing]
        end
    end

    %% Horizontal Pod Autoscaler
    subgraph HPA["ğŸ“ˆ HORIZONTAL POD AUTOSCALER"]
        direction TB
        DeclarationHPA[ğŸ“‹ Declaration Service HPA<br/>Min: 3, Max: 10<br/>CPU: 70%, Memory: 80%]
        KeycloakHPA[ğŸ” Keycloak HPA<br/>Min: 3, Max: 6<br/>CPU: 80%]
        KongHPA[ğŸ¦ Kong HPA<br/>Min: 3, Max: 8<br/>CPU: 75%]
    end

    %% Resource Quotas and Limits
    subgraph Resources["ğŸ“ RESOURCE MANAGEMENT"]
        direction TB
        
        subgraph ResourceQuotas["Resource Quotas"]
            ProdQuota[ğŸ”´ Production Quota<br/>CPU: 200 cores<br/>Memory: 800Gi<br/>Storage: 10Ti]
            MonitorQuota[ğŸ“Š Monitoring Quota<br/>CPU: 50 cores<br/>Memory: 200Gi<br/>Storage: 5Ti]
        end
        
        subgraph LimitRanges["Limit Ranges"]
            PodLimits[ğŸ“¦ Pod Limits<br/>CPU: 100m-4000m<br/>Memory: 128Mi-8Gi]
            ContainerLimits[ğŸ“¦ Container Limits<br/>CPU: 50m-2000m<br/>Memory: 64Mi-4Gi]
        end
    end

    %% Network Policies
    subgraph NetworkPolicies["ğŸŒ NETWORK POLICIES"]
        direction TB
        
        subgraph ServiceMesh["Service Mesh (Optional)"]
            Istio[ğŸ•¸ï¸ Istio Service Mesh<br/>mTLS, Traffic Management<br/>Observability]
        end
        
        subgraph NetworkSecurity["Network Security"]
            ProdNetPolicy[ğŸ”´ Production Network Policy<br/>Ingress: API Gateway Only<br/>Egress: Database, External APIs]
            DataNetPolicy[ğŸ—ƒï¸ Data Network Policy<br/>Ingress: App Services Only<br/>Egress: Backup Systems]
            MonitorNetPolicy[ğŸ“Š Monitor Network Policy<br/>Ingress: All Namespaces<br/>Egress: Alert Systems]
        end
    end

    %% Flow Connections
    Internet --> IngressController
    IngressController --> IngressService
    IngressService --> KongService
    KongService --> KongPod
    
    KongPod --> CoreServices
    KongPod --> IntegrationServices
    KongPod --> CrossCuttingServices
    
    CoreServices --> DatabaseCluster
    CoreServices --> StorageCluster
    CoreServices --> CacheCluster
    CoreServices --> MessageQueue
    
    DatabaseCluster --> DBPV
    StorageCluster --> MinIOPV
    CacheCluster --> DBPV
    MessageQueue --> DBPV
    
    AppConfig --> CoreServices
    DBSecrets --> DatabaseCluster
    APISecrets --> IntegrationServices
    TLSSecrets --> IngressController

    HPA --> CoreServices
    HPA --> CrossCuttingServices
    
    MonitoringPods --> CoreServices
    MonitoringPods --> DataLayer
    LoggingPods --> CoreServices
    TracingPods --> CoreServices

    %% Styling
    classDef namespaceBox fill:#e1f5fe,stroke:#01579b,stroke-width:3px,color:#000
    classDef serviceBox fill:#f1f8e9,stroke:#33691e,stroke-width:2px,color:#000
    classDef dataBox fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#000
    classDef configBox fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
    classDef monitorBox fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000

    class Production,Monitoring namespaceBox
    class CoreServices,IntegrationServices,CrossCuttingServices,ApiGateway serviceBox
    class DataLayer,Storage dataBox
    class ConfigMgmt,Resources,NetworkPolicies configBox
    class MonitoringPods,LoggingPods,TracingPods,HPA monitorBox