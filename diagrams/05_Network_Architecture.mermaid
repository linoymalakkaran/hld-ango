%%{init: {'theme':'base', 'themeVariables': {'fontSize': '8px', 'fontFamily': 'Arial, sans-serif'}}}%%
graph TB
    %% External Network
    subgraph Internet["ğŸŒ INTERNET"]
        Users[ğŸ‘¥ External Users<br/>Traders, Brokers, Officers]
        ExternalSystems[ğŸ›ï¸ External Systems<br/>ASYCUDA, SINTECE, OGAs]
        Admins[ğŸ‘¨â€ğŸ’» System Administrators<br/>Remote Access]
    end

    %% DMZ Zone
    subgraph DMZ["ğŸ”¥ DMZ ZONE - 172.16.1.0/24"]
        direction TB
        
        subgraph EdgeSecurity["Edge Security"]
            Firewall[ğŸ”¥ Firewall<br/>iptables/pfSense<br/>172.16.1.1]
            WAF[ğŸ›¡ï¸ Web Application Firewall<br/>ModSecurity<br/>172.16.1.10]
            DDoSProtection[ğŸš« DDoS Protection<br/>Rate Limiting<br/>172.16.1.11]
        end
        
        subgraph LoadBalancers["Load Balancers"]
            ExternalLB[âš–ï¸ External Load Balancer<br/>HAProxy/NGINX<br/>172.16.1.20]
            SSLTLS[ğŸ”’ SSL/TLS Termination<br/>TLS 1.3<br/>172.16.1.21]
        end
        
        subgraph VPNGateway["VPN Access"]
            VPNServer[ğŸ”’ VPN Gateway<br/>Admin Access<br/>172.16.1.30]
            BastionHost[ğŸ° Bastion Host<br/>Jump Server<br/>172.16.1.31]
        end
    end

    %% Application Zone
    subgraph AppZone["âš™ï¸ APPLICATION ZONE - 10.10.0.0/16"]
        direction TB
        
        subgraph K8sCluster["Kubernetes Cluster Network"]
            subgraph MasterNodes["Master Nodes - 10.10.1.0/24"]
                Master1[ğŸ›ï¸ K8s Master 1<br/>10.10.1.10]
                Master2[ğŸ›ï¸ K8s Master 2<br/>10.10.1.11]
                Master3[ğŸ›ï¸ K8s Master 3<br/>10.10.1.12]
            end
            
            subgraph WorkerNodes["Worker Nodes - 10.10.2.0/24"]
                Worker1[ğŸ’» K8s Worker 1<br/>10.10.2.10]
                Worker2[ğŸ’» K8s Worker 2<br/>10.10.2.11]
                Worker3[ğŸ’» K8s Worker 3<br/>10.10.2.12]
                WorkerN[ğŸ’» K8s Worker N<br/>10.10.2.20+]
            end
        end
        
        subgraph PodNetwork["Pod Network - 10.10.100.0/22"]
            subgraph AppPods["Application Pods"]
                KongPods[ğŸ¦ Kong API Gateway<br/>10.10.100.10-12]
                ServicePods[âš™ï¸ Microservice Pods<br/>10.10.101.0/24]
                KeycloakPods[ğŸ” Keycloak Pods<br/>10.10.102.10-12]
            end
        end
        
        subgraph ServiceNetwork["Service Network - 10.10.200.0/24"]
            KongService[ğŸ¦ Kong Service<br/>ClusterIP: 10.10.200.10]
            CoreServices[âš™ï¸ Core Services<br/>ClusterIP: 10.10.200.20-30]
            IntegrationServices[ğŸ”Œ Integration Services<br/>ClusterIP: 10.10.200.40-50]
        end
    end

    %% Data Zone
    subgraph DataZone["ğŸ—ƒï¸ DATA ZONE - 10.20.0.0/16"]
        direction TB
        
        subgraph DatabaseNetwork["Database Network - 10.20.1.0/24"]
            PostgreSQLMaster[ğŸ—ƒï¸ PostgreSQL Master<br/>10.20.1.10]
            PostgreSQLReplica1[ğŸ—ƒï¸ PostgreSQL Replica 1<br/>10.20.1.11]
            PostgreSQLReplica2[ğŸ—ƒï¸ PostgreSQL Replica 2<br/>10.20.1.12]
            PostgreSQLBackup[ğŸ’¾ PostgreSQL Backup<br/>10.20.1.20]
        end
        
        subgraph StorageNetwork["Storage Network - 10.20.2.0/24"]
            MinIONode1[ğŸ“¦ MinIO Node 1<br/>10.20.2.10]
            MinIONode2[ğŸ“¦ MinIO Node 2<br/>10.20.2.11]
            MinIONode3[ğŸ“¦ MinIO Node 3<br/>10.20.2.12]
            MinIONodeN[ğŸ“¦ MinIO Node N<br/>10.20.2.20+]
        end
        
        subgraph CacheNetwork["Cache Network - 10.20.3.0/24"]
            RedisMaster[âš¡ Redis Master<br/>10.20.3.10]
            RedisSentinel[ğŸ” Redis Sentinel<br/>10.20.3.11-13]
            RedisReplicas[âš¡ Redis Replicas<br/>10.20.3.20-22]
        end
        
        subgraph MessageNetwork["Message Queue Network - 10.20.4.0/24"]
            RabbitMQNode1[ğŸ° RabbitMQ Node 1<br/>10.20.4.10]
            RabbitMQNode2[ğŸ° RabbitMQ Node 2<br/>10.20.4.11]
            RabbitMQNode3[ğŸ° RabbitMQ Node 3<br/>10.20.4.12]
        end
    end

    %% Management Zone
    subgraph MgmtZone["ğŸ“Š MANAGEMENT ZONE - 10.30.0.0/16"]
        direction TB
        
        subgraph MonitoringNetwork["Monitoring Network - 10.30.1.0/24"]
            Prometheus[ğŸ“ˆ Prometheus<br/>10.30.1.10]
            Grafana[ğŸ“Š Grafana<br/>10.30.1.11]
            AlertManager[ğŸš¨ AlertManager<br/>10.30.1.12]
        end
        
        subgraph LoggingNetwork["Logging Network - 10.30.2.0/24"]
            Elasticsearch[ğŸ” Elasticsearch<br/>10.30.2.10-12]
            Logstash[ğŸ“‹ Logstash<br/>10.30.2.20-21]
            Kibana[ğŸ“Š Kibana<br/>10.30.2.30]
        end
        
        subgraph BackupNetwork["Backup Network - 10.30.3.0/24"]
            BackupServer[ğŸ’¾ Backup Server<br/>10.30.3.10]
            BackupStorage[ğŸ’¾ Backup Storage<br/>10.30.3.11-15]
        end
        
        subgraph ConfigNetwork["Configuration Management - 10.30.4.0/24"]
            ConfigServer[âš™ï¸ Configuration Server<br/>10.30.4.10]
            SecretsManager[ğŸ” Secrets Manager<br/>10.30.4.11]
            CertManager[ğŸ“œ Certificate Manager<br/>10.30.4.12]
        end
    end

    %% Network Security and Routing
    subgraph NetworkSecurity["ğŸ›¡ï¸ NETWORK SECURITY & ROUTING"]
        direction TB
        
        subgraph VLANs["VLAN Segmentation"]
            DMZ_VLAN[ğŸ”¥ DMZ VLAN 100<br/>172.16.1.0/24]
            APP_VLAN[âš™ï¸ Application VLAN 200<br/>10.10.0.0/16]
            DATA_VLAN[ğŸ—ƒï¸ Data VLAN 300<br/>10.20.0.0/16]
            MGMT_VLAN[ğŸ“Š Management VLAN 400<br/>10.30.0.0/16]
        end
        
        subgraph RoutingRules["Routing Rules"]
            DMZToApp[ğŸ”¥â†’âš™ï¸ DMZ to App<br/>Port 80,443,8080]
            AppToData[âš™ï¸â†’ğŸ—ƒï¸ App to Data<br/>Port 5432,9000,6379,5672]
            AppToMgmt[âš™ï¸â†’ğŸ“Š App to Mgmt<br/>Port 9090,3000,9093]
            MgmtToAll[ğŸ“Šâ†’ğŸŒ Mgmt to All<br/>Monitoring Ports]
            NoDirectData[ğŸš« No Direct Data Access<br/>External â†’ Data Blocked]
        end
        
        subgraph FirewallRules["Firewall Rules"]
            AllowHTTPS[âœ… Allow HTTPS<br/>Port 443 Internet â†’ DMZ]
            AllowHTTP[âœ… Allow HTTP<br/>Port 80 Internet â†’ DMZ]
            AllowVPN[âœ… Allow VPN<br/>Port 1194 Internet â†’ DMZ]
            AllowSSH[âœ… Allow SSH<br/>Port 22 VPN â†’ Management]
            DenyDirect[âŒ Deny Direct<br/>Internet â†’ Internal Networks]
        end
    end

    %% CNI and Service Mesh
    subgraph CNI["ğŸ•¸ï¸ CONTAINER NETWORK INTERFACE"]
        direction TB
        
        subgraph PodNetworking["Pod Networking (CNI)"]
            Calico[ğŸ•¸ï¸ Calico CNI<br/>Network Policies<br/>BGP Routing]
            NetworkPolicies[ğŸ“‹ Network Policies<br/>Ingress/Egress Rules<br/>Pod-to-Pod Security]
        end
        
        subgraph ServiceMesh["Service Mesh (Optional)"]
            Istio[ğŸ•¸ï¸ Istio Service Mesh<br/>mTLS Encryption<br/>Traffic Management]
            Envoy[ğŸ”„ Envoy Proxy<br/>Sidecar Pattern<br/>Load Balancing]
        end
    end

    %% External Connectivity
    subgraph ExternalConnectivity["ğŸŒ EXTERNAL CONNECTIVITY"]
        direction TB
        
        subgraph GovernmentNetworks["Government Networks"]
            AGTNetwork[ğŸ›ï¸ AGT Network<br/>ASYCUDA Integration<br/>Dedicated Line]
            SINTECENetwork[ğŸ›ï¸ SINTECE Network<br/>Government Backbone<br/>VPN Tunnel]
            OGANetworks[ğŸ›ï¸ OGA Networks<br/>Multiple Agencies<br/>Internet/VPN]
        end
        
        subgraph BankingNetworks["Banking Networks"]
            BankConnections[ğŸ¦ Banking Networks<br/>Payment Processing<br/>Secure Channels]
        end
    end

    %% Network Flow Connections
    Users --> Firewall
    ExternalSystems --> Firewall
    Admins --> VPNServer
    
    Firewall --> WAF
    WAF --> DDoSProtection
    DDoSProtection --> ExternalLB
    ExternalLB --> SSLTLS
    SSLTLS --> KongService
    
    VPNServer --> BastionHost
    BastionHost --> MgmtZone
    
    KongService --> ServicePods
    ServicePods --> DatabaseNetwork
    ServicePods --> StorageNetwork
    ServicePods --> CacheNetwork
    ServicePods --> MessageNetwork
    
    ServicePods --> MonitoringNetwork
    DatabaseNetwork --> BackupNetwork
    StorageNetwork --> BackupNetwork
    
    IntegrationServices --> AGTNetwork
    IntegrationServices --> SINTECENetwork
    IntegrationServices --> OGANetworks
    ServicePods --> BankConnections

    %% Styling
    classDef dmzBox fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#000
    classDef appBox fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
    classDef dataBox fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#000
    classDef mgmtBox fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000
    classDef securityBox fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef externalBox fill:#fce4ec,stroke:#ad1457,stroke-width:2px,color:#000

    class DMZ dmzBox
    class AppZone appBox
    class DataZone dataBox
    class MgmtZone mgmtBox
    class NetworkSecurity,CNI securityBox
    class Internet,ExternalConnectivity externalBox